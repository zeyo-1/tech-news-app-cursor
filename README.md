# Tech News App

## 概要
テクノロジー関連のニュースを自動収集し、AIによる要約を提供するWebアプリケーションです。

## データベース構造
アプリケーションは以下のテーブル構造でデータを管理しています：

### 記事関連テーブル
- `articles`: メインの記事テーブル（タイトル、内容、メタ情報など）
- `article_summaries`: 記事要約テーブル
- `article_analytics`: 記事のアクセス分析データ
- `article_likes`: 記事のいいね情報
- `news`: RSSフィードから取得したニュース記事
- `news_categories`: ニュースとカテゴリーの関連付け
- `read_later`: 後で読む記事の管理
- `view_history`: 記事の閲覧履歴
- `page_views`: ページビュー統計

### カテゴリー関連テーブル
- `categories`: メインカテゴリー
- `subcategories`: サブカテゴリー
- `user_category_preferences`: ユーザーのカテゴリー設定

### ユーザー関連テーブル
- `profiles`: ユーザープロフィール（管理者フラグ含む）
- `users`: ユーザー基本情報
- `user_settings`: ユーザーの一般設定（テーマ設定、言語設定など）
- `user_sessions`: ユーザーセッション情報

### 通知関連テーブル
- `notification_settings`: ユーザーごとの通知設定
- `notification_history`: 送信された通知の履歴
- `notification_queue`: 通知送信キュー
- `notification_channels`: 通知チャンネル（メール、Slack、LINE）の設定
- `notification_templates`: 通知テンプレート
- `keywords_watch`: ユーザーが監視したいキーワード

### フィードバック関連テーブル
- `feedback`: ユーザーからのフィードバック
- `feature_requests`: 機能リクエスト

### ログ・監視関連テーブル
- `activity_logs`: システムの操作ログ（月次パーティション）
  - `activity_logs_y2024m01`: 2024年1月のログ
  - `activity_logs_y2024m02`: 2024年2月のログ
- `error_logs`: システムエラーログ
- `system_logs`: 一般システムログ
- `api_usage_logs`: API使用状況ログ
- `health`: システムヘルスチェック情報

### システム設定・管理テーブル
- `system_settings`: システム全体の設定
- `batch_jobs`: バッチ処理ジョブ管理
- `job_executions`: ジョブ実行履歴

## ユーザー種別と機能要件

### 1. ログインしていないユーザー
以下の機能を利用できます：
- ホームページへアクセスし、記事を閲覧、検索する
- 記事カードをクリックし、各記事の詳細を閲覧する
- 認証ページへアクセスし、アカウントを作成する
- サイドバーからリーガルアイテムの各項目のページにアクセスし閲覧する
※ 許可されていない機能へアクセスしようとした際は認証ページへ遷移します

### 2. 通常のアカウントでログインしたユーザー
上記の機能に加え、以下の機能を利用できます：
- プロフィールページへアクセスし、プロフィールを閲覧、編集する
- 任意の記事を「お気に入り」に登録し、一覧を閲覧する
- 任意の記事を「後で見る」に登録し、一覧を閲覧する
- 閲覧履歴一覧を閲覧する
- 設定の変更やフィードバックの送信を行う

将来的な実装予定：
- 設定したカテゴリーやキーワードに基づくメール通知機能
- Slack/LINEとの連携による通知機能

### 3. 管理者アカウントでログインしたユーザー
上記の機能に加え、以下の機能を利用できます：
- 管理者ページへアクセスし、記事の取得、要約、投稿、削除を行う
- 管理者による記事の直接作成
- その他管理者権限による操作

## 主な機能
- 複数のテックニュースサイトからのRSSフィード取得
- DeepSeek APIを使用した記事の自動要約
- キャッシュシステムによる高速なレスポンス
- 重複記事の自動検出と除外
- 記事の重要度に基づく自動ソート

## 技術スタック
### フロントエンド
- Next.js 15.1.5
- TypeScript
- Tailwind CSS
- shadcn/ui（UIコンポーネント）
- framer-motion（アニメーション）

### バックエンド
- DeepSeek API（要約生成）
- RSS Parser
- Axios
- Cheerio（スクレイピング）

## セットアップ
1. リポジトリのクローン
```bash
git clone [repository-url]
cd tech-news-app-cursor
```

2. 依存関係のインストール
```bash
npm install
```

3. 環境変数の設定
`.env.local`ファイルを作成し、以下の環境変数を設定：
```
DEEPSEEK_API_KEY=your_api_key_here
```

4. 開発サーバーの起動
```bash
npm run dev
```

## API エンドポイント
- `GET /api/test-rss`: 最新のニュース記事を取得

## 注意事項
- DeepSeek APIの利用には有効なAPIキーが必要です
- RSSフィードの取得間隔に制限があります
- キャッシュの有効期限は30分に設定されています

## 開発環境
- Node.js 18.x以上
- npm 9.x以上

## 実装計画

### フェーズ1: 基盤構築とコア機能（4-6週間）
1. **CI/CD・テスト基盤の整備**（1週間）
   - GitHub Actionsの設定（Githubでコードを自動的にチェック）
   - テスト環境の構築（Vercelでテスト環境を構築、ただし、テスト環境ではデプロイしない）
   - デプロイメントパイプラインの整備（コードを本番環境に安全に届けるための「配送システム」）

2. **記事取得・表示機能の実装**（2週間）
   - RSS/APIからの記事取得機能
   - 記事の保存・管理機能
   - 記事一覧・詳細表示機能
   - 記事のカテゴリー分類（基本実装）

3. **認証・認可システムの完成**（1-2週間）
   - ユーザー管理機能の拡充
   - 権限管理の実装
   - プロフィール機能

### フェーズ2: 自動化とAI機能（4-5週間）
4. **バッチ処理システムの基本実装**（2週間）
   - 記事の定期収集Cronジョブ
   - エラーハンドリングとリトライ機構
   - Slack通知システム

5. **AI機能の実装**（2-3週間）
   - 記事要約機能
   - 重要度スコアリング
   - カテゴリー自動分類の高度化
   - 関連記事推薦システム

### フェーズ3: 監視とログ（3-4週間）
6. **基本的な監視システムの実装**（2週間）
   - エラーログ収集
   - パフォーマンスモニタリング
   - API使用量の監視

7. **アラートシステムの実装**（1-2週間）
   - Slackアラート
   - エラーエスカレーション
   - 管理者ダッシュボード

### フェーズ4: UX改善（3-4週間）
8. **検索機能の強化**（1週間）
   - 全文検索
   - フィルタリング
   - ソート機能

9. **UI/UXの改善**（2-3週間）
   - レスポンシブデザインの完全対応
   - パフォーマンス最適化
   - アクセシビリティ対応

### フェーズ5: 最適化と拡張（2-3週間）
10. **システムの最適化**（2-3週間）
    - キャッシュ戦略の実装
    - データベースの最適化
    - フロントエンドのコード分割

各フェーズで以下を並行して進める：
- ドキュメント作成
- テストケースの作成・実行
- コードレビュー
- パフォーマンステスト

## 実装状況
- [x] 基本的なRSSフィード取得機能
- [x] 記事の自動要約機能
- [x] キャッシュシステム
- [x] Cron Job による定期実行
- [x] 管理者ダッシュボードの基本構造
- [x] アクティビティログ機能
- [x] エラーログ機能
- [ ] バッチ処理管理機能
- [ ] ユーザー認証システム（実装中）
- [ ] プロフィール管理機能
- [ ] お気に入り機能
- [ ] 後で読む機能
- [ ] 閲覧履歴機能
- [ ] メール通知機能（予定）
- [ ] Slack/LINE連携（予定）

## ライセンス
MIT License

## 技術的な仕様

### 定期実行の実装
- Vercel Cron Jobsを使用して記事の取得と要約を自動化
- 実行スケジュール：毎日10時に実行（JST）
- エンドポイント: `/api/cron`（GET）
- セキュリティ：
  - 環境変数`CRON_SECRET`による認証
  - Vercelの署名検証による不正アクセス防止
- 手動実行：管理者ダッシュボードから実行可能

### 認証・認可
- 管理者アカウントは`profiles`テーブルの`is_admin`フラグで管理
- 管理者権限の付与はSupabaseダッシュボードから手動で実施

### 通知システム
- メール通知: Resend.com（月3000通まで無料）を使用
- Slack連携: Slack Apps（Botトークン）を使用
- LINE連携: LINE Messaging API（月200通まで無料）を使用

### UI/UX設計
#### 記事詳細の表示方法
ハイブリッドアプローチを採用：
- デフォルト: モーダル表示 (`/articles?id=xxx&modal=true`)
- ページ遷移表示 (`/articles/xxx`):
  - 直接URLアクセス時
  - 共有リンクからのアクセス時
  - 画面サイズが小さい場合
  - ユーザーが「記事を開く」を選択した場合

#### 管理者ダッシュボード設計

サイドバーナビゲーションによる以下の機能へのアクセス：

1. **ダッシュボード（概要）**
   - 総記事数の表示
   - 本日の新規記事数の表示
   - 最終更新日時の表示
   - エラー発生状況の表示（記事取得/要約の失敗数）
   - システムステータス（API接続状態、キャッシュ状態など）
   - 直近のアクティビティログ
   - 記事の手動取得機能

2. **記事管理**
   - 記事一覧（フィルタリング、ソート機能）
   - 手動での記事取得・要約実行
   - カテゴリー管理
   - 記事の編集・削除
   - 記事のステータス管理（公開/非公開/下書き）
   - 記事の優先度設定
   - バッチ操作（複数記事の一括処理）
   - 要約の手動編集機能
   - タグ管理機能

3. **ユーザー管理**
   - ユーザー一覧
   - 権限管理
   - アクセス制限設定
   - ユーザーの利用状況（最終ログイン、アクティブ状態）
   - アカウント停止/復帰機能
   - ユーザーフィードバックの管理

4. **分析**
   - アクセス統計
   - 記事パフォーマンス分析
   - ユーザー行動分析

5. **通知設定**
   - 通知設定
   - 通知履歴
   - 通知テンプレート管理
   - プッシュ通知の設定
   - 通知の優先度設定
   - 通知送信テスト機能

6. **システム設定**
   - RSSフィード設定
   - API設定（DeepSeek、Resend等）
   - キャッシュ設定
   - バックアップ/リストア設定
   - パフォーマンスチューニング
   - エラーログの表示と管理
   - メンテナンスモード設定

7. **ログ管理**
   - システムログ
   - アクセスログ
   - エラーログ
   - 操作ログ
   - ログの検索・フィルタリング
   - ログのエクスポート機能

8. **バッチ管理**
   - 定期実行ジョブの状態確認
   - スケジュール設定
   - 手動実行機能
   - ジョブ履歴の表示
   - エラー時の再実行設定

実装の特徴：
- レスポンシブ対応のUI（モバイル対応済み）
- ダークモード対応
- アクセシビリティ対応
- エラーハンドリング
